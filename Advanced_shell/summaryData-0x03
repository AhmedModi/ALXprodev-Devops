#!/bin/bash

# Create output CSV
output_file="pokemon_report.csv"
echo "Name,Height (m),Weight (kg)" > "$output_file"

# Variables to store total for average calculation
total_height=0
total_weight=0
count=0

# Loop through all JSON files
for file in pokemon_data/*.json; do
    name=$(jq -r '.name' "$file")
    height_dm=$(jq -r '.height' "$file")  # height in decimeters
    weight_hg=$(jq -r '.weight' "$file")  # weight in hectograms

    height_m=$(awk "BEGIN {printf \"%.2f\", $height_dm * 0.1}")
    weight_kg=$(awk "BEGIN {printf \"%.2f\", $weight_hg * 0.1}")

    echo "$name,$height_m,$weight_kg" >> "$output_file"

    total_height=$(awk "BEGIN {print $total_height + $height_m}")
    total_weight=$(awk "BEGIN {print $total_weight + $weight_kg}")
    ((count++))
done

# Display results
echo ""
echo "CSV Report generated at: $output_file"
echo ""

cat "$output_file"

avg_height=$(awk "BEGIN {printf \"%.2f\", $total_height / $count}")
avg_weight=$(awk "BEGIN {printf \"%.2f\", $total_weight / $count}")

echo ""
echo "Average Height: $avg_height m"
echo "Average Weight: $avg_weight kg"
